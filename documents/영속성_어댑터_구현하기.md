# 영속성 어댑터 구현하기 

여기서는 어플리케이션 서비스에 영속성 기능을 제공해주는 영속성 어댑터를 구현할 때 고려해야 하는 사항이 뭔지 알아보자. 

영속성 어댑터가 제공해주는 기능은 다음과 같다. 

- 입력을 받으면 데이터베이스 포맷으로 변경해서 데이터베이스로 보내는 것. 

- 데이터베이스 출력을 어플리케이션 포맷으로 변환해서 출력하는 것. 

영속성 어댑터의 기능의 변경을 서비스에 전달하지 않도록 하기 위함으로 영속성 어댑터는 포트라는 간접 계층을 둬서 서비스와 연결된다. 

포트를 만들 땐 여러가지 기능을 가진 포트를 서비스에서 사용하도록 하는 방법보다 각각 서비스마다 필요한 포트를 나누는 방식이 낫다. 

이는 인터페이스 분리 원칙 (Interface Segregation Principle) 과 관련이 있다.

딱 쓰는 기능 외에 더 많은 기능은 오해를 줄 수 있고 잘못된 사용을 하도록 할 수도 있다.

영속성 어댑터를 작성할 때도 하나의 거대한 영속성 어댑터보다는 도메인 클래스 또는 도메인 어그리게이트 (Aggregate) 마다 하나의 영속성 어댑터를 가지도록 하는게 낫다.

영속성 어댑터는 그리고 JPA 와 같은 ORM 도구를 이용할 수도 성능상의 이유로 보통의 SQL 을 이용한 어댑터를 사용하는 방식도 있을 수 있다. 

마지막으로 트랜잭션과 관련된 이야기인데 트랜잭션의 경우 작업의 단위이다. 

그러므로 영속성 어댑터에선 어디까지가 작업의 단위인지 알 지 못하므로 유스 케이스에 적는게 맞다. 

스프링의 경우 `@Transactional` 을 통해서 트랜잭션을 작성하는데 이게 유스 케이스에 있는 걸 원하지 않는다면 AspectJ 와 같은 도구를 이용해 트랜잭션 경계를 코드에 위빙 (weaving) 하도록 할 수 있다. 

